# Dashboard

- Untuk membuat dashboard shadcn sudah menyediakan komponen sidebar yang bisa langsung di install dan digunakan
- Ketika meng-install sidebar, maka akan dibuatkan komponen `sidebar.tsx`, `sheet.tsx`, `separator.tsx`, `skeleton.tsx`, `tooltip.tsx` didalam folder `components\ui`
- Selain komponen diatas, kita juga akan dibuatkan custom hooks `use-mobile.ts` dalam folder `src\hooks`
- Sebagai tambahan, bisa install avatar dan breadcrumb untuk digunakan pada dashboard

```bash
npx shadcn@latest add sidebar avatar breadcrumb
```

### Dashboard Layout

- Buat folder grouping `src\app\(dashboard)` untuk halaman dashboard
- Buat folder `src\app\(dashboard)\admin` untuk halaman admin dashboard
- Buat file `layout.tsx` dalam folder `src\app\(dashboard)` untuk layout khusus halaman dashboard

```bash
├─ src
│  └─ app
│     ├─ (dashboard)
│     │     ├─ admin
│     │     │    ├─ _components
│     │     │    │    └─ login.tsx
│     │     │    └─ page.tsx
│     │     └─ layout.tsx
│     ├─ favicon.ico
│     ├─ global.css
│     ├─ page.tsx
│     └─ layout.tsx
└─ other folder
```

- Panggil `<SidebarProvider></SidebarProvider>` didalam `layout.tsx`
- Buat file `app-sidebar.tsx` di `components\common` untuk isi dari sidebar nya
- Kemudian panggil didalam `layout.tsx` dan bungkus didalam `<SidebarProvider></SidebarProvider>`
- Panggil component `<SidebarInset></SidebarInset>` untuk navigasi yang terpisah dari komponen `AppSidebar`.

```tsx
return (
  <SidebarProvider>
    <AppSidebar />
    <SidebarInset>
      <header>
        <div>
          <SidebarTrigger />
          <Separator />
        </div>
        <div>
          <DarkModeToggle />
        </div>
      </header>
      <main>{children}</main>
    </SidebarInset>
  </SidebarProvider>
);
```

### Dashboard Breadcrumb

- Breadcrumb digunakan untuk navigasi antar halaman dashboard
- Buat file `dashboard-breadcrumb.tsx` di `src\app\(dashboard)\_components` untuk komponent breadcrumb nya.
- Kemudian panggil didalam `layout.tsx` dan bungkus didalam `<SidebarProvider></SidebarProvider>`
- Gunakan `usePathname` untuk mendapatkan path/url saat ini yang sedang diakses yang akan digunakan untuk menampilkan breadcrumb
- Buat pengecekan pada path untuk breadcrump, jika path yang tidak sedang diakses maka menggunakan `<BreadcrumbLink></BreadcrumbLink>` sehingga apabila diklik akan menuju redirect ke halaman tersebut.
- Tapi jika halaman sedang diakses maka menggunakan `<BreadcrumbPage></BreadcrumbPage>` agar breadcrumb tersebut tidak bisa diklik

```tsx
<BreadcrumbItem className="capitalize">
  {index < paths.length - 1 ? (
    <BreadcrumbLink href={`/${paths.slice(0, index + 1).join("/")}`}>
      {path}
    </BreadcrumbLink>
  ) : (
    <BreadcrumbPage>{path}</BreadcrumbPage>
  )}
</BreadcrumbItem>
```

- Selain itu, lakukan pengecekan juga untuk <BreadcrumbSeparator/>` agar hanya muncul jika bukan halaman terakhir

```tsx
{
  index < paths.length - 1 && (
    <BreadcrumbSeparator className="text-muted-foreground" />
  );
}
```

### Sidebar Menu

- Untuk membuat menu di sidebar, kita bisa terlebih dahulu membuat file `sidebar-constant.ts` di `src\constants` sebagai konstanta untuk menu-menu yang ada di sidebar sehingga jika ada perubahan, hanya perlu merubah di satu tempat saja
- Data yang dibuat didalam `sidebar-constant.ts` adalah `title`, `url` dan `icon`
- Kemudian tinggal di maping dalam `app-sidebar.tsx` dan di bungkus dalam `<SidebarContent></SidebarContent>` untuk menampilkan menu-menu di sidebar

```tsx
<SidebarContent>
  <SidebarGroup>
    <SidebarGroupContent className="flex flex-col gap-2">
      <SidebarMenu>
        {SIDEBAR_MENU_LIST[profile.role as SidebarMenuKey]?.map((item) => (
          <SidebarMenuItem key={item.title}>
            <SidebarMenuButton asChild tooltip={item.title}>
              <a
                href={item.url}
                className={cn("h-auto px-4 py-3", {
                  "bg-indigo-500 text-slate-100 hover:bg-indigo-600 hover:text-slate-100":
                    pathname === item.url,
                })}
              >
                {item.icon && <item.icon className="size-5" />}
                <span>{item.title}</span>
              </a>
            </SidebarMenuButton>
          </SidebarMenuItem>
        ))}
      </SidebarMenu>
    </SidebarGroupContent>
  </SidebarGroup>
</SidebarContent>
```

### Signout

- Untuk logout, pertama buat folder `src\actions`
- Kemudian buat file `auth-actions.ts` didalam folder tersebut
- Disini menggunakan server action agar bisa mengakses cookies
- Buat koneksi supabase dan cookies

```ts
const supabase = await createClient();
const cookiesStore = await cookies();
```

- Kemudian lakukan signout dari supabase dengan menggunakan `supabase.auth.signOut()`
- Setelah itu delete cookies dengan menggunakan `cookiesStore.delete("user_profile")`
- Key cookies yang dihapus adalah `user_profile` sama seperti ketika login kita membuat key cookies tersebut. Maka ketika login kita menggunakan `cookiesStore.set("user_profile", JSON.stringify(profile), { ... })` dan ketika logout kita menggunakan `cookiesStore.delete("user_profile")`
- Kemudian lakukan revalidatePath untuk memperbarui halaman yang sedang diakses
- Jika sign out berhasil , maka akan di redirect ke halaman login

```ts
export async function signOut() {
  const supabase = await createClient();
  const cookiesStore = await cookies();
  try {
    await supabase.auth.signOut();
    cookiesStore.delete("user_profile");
    revalidatePath("/", "layout");
  } catch (error) {
    console.error("Error sign out:", error);
  }
  redirect("/login");
}
```

### State Management

- Untuk state management kita bisa menggunakan `zustand`. Install zustand:

```bash
npm i zustand@5.0.6
## project ini menggunakan versi zustand@5.0.6
```

- Buat type untuk profile di `src/types/auth.d.ts` dengan data `name`, `role`, `avatar_url`
- Buat file `src/stores/auth-store.ts` untuk menyimpan dan mengelola state management
- Buat `src/providers/auth-strore-provider.tsx` untuk membungkus semua komponen agar bisa menggunakan `store`-nya.
- Bungkus semua yang ada di root `layout.tsx` dengan `<AuthStoreProvider></AuthStoreProvider>`
- Dan setelah ini, jika ada yang memerlukan profile maka bisa menggunakan `useAuthStore()` untuk mengambil profile dari store
- Maka kemudian, kita lakukan perubahan di `app-sidebar.tsx` agar bisa menampilkan profile yang ada di store. Karena sebelumnya profile menggunakan dummy data, maka kita perlu mengubahnya dengan menggunakan `useAuthStore()` untuk mengambil profile dari store

```tsx
// kode sebelum
const profile = { name: "Faqih Nur Fahmi", role: "admin", avatar_url: "" };

// kode setelah
const profile = useAuthStore((state) => state.profile);
```

- Pastikan RLS policy di supabase sudah di setting/enable

### Fetch Data

- Pada project ini kita menggunakan tanstack react query untuk fetching data.
- Install tanstack react query:

```bash
npm i @tanstack/react-query
```

- Buat file `src/providers/query-provider.tsx` sebagai provider untuk menyimpan react query
- Bungkus semua yang ada di root `layout.tsx` dengan `<QueryClientProvider></QueryClientProvider>`
